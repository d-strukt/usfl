!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.usfl=t()}}(function(){var t;return function e(t,n,i){function o(r,a){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,n){!function(e){function i(t,e,n,i,o){this._listener=e,this._isOnce=n,this.context=i,this._signal=t,this._priority=o||0}function o(t,e){if("function"!=typeof t)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}function s(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){s.prototype.dispatch.apply(t,arguments)}}i.prototype={active:!0,params:null,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,n),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},s.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(t,e,n,o){var s,r=this._indexOfListener(t,n);if(-1!==r){if(s=this._bindings[r],s.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else s=new i(this,t,e,n,o),this._addBinding(s);return this.memorize&&this._prevParams&&s.execute(this._prevParams),s},_addBinding:function(t){var e=this._bindings.length;do--e;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var n,i=this._bindings.length;i--;)if(n=this._bindings[i],n._listener===t&&n.context===e)return i;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,n){return o(t,"add"),this._registerListener(t,!1,e,n)},addOnce:function(t,e,n){return o(t,"addOnce"),this._registerListener(t,!0,e,n)},remove:function(t,e){o(t,"remove");var n=this._indexOfListener(t,e);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(){for(var t=this._bindings.length;t--;)this._bindings[t]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,e=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=e),n){t=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var r=s;r.Signal=s,"function"==typeof t&&t.amd?t(function(){return r}):"undefined"!=typeof n&&n.exports?n.exports=r:e.signals=r}(this)},{}],2:[function(t,e){"use strict";var n={isArray:function(t){return t instanceof Array},sortNumeric:function(t){return t.sort(function(t,e){return t-e})},sortRandom:function(t){return t.sort(function(){return Math.random()>.5?-1:1})},getRandom:function(t){return t[Math.floor(Math.random()*t.length)]}};"object"==typeof e&&e.exports&&(e.exports=n)},{}],3:[function(t,e){"use strict";function n(){this.onChildComplete=new o.Signal,this.onComplete=new o.Signal,this.onProgress=new o.Signal,this.onError=new o.Signal,this.queue=[],this.index=0,this.loaders={},this.loaded=!1,this.webAudioContext=null,this.crossOrigin=!1,this.touchLocked=!1,this.numTotal=0,this.numLoaded=0}function i(){var t,e,n,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof window.ActiveXObject)for(e=0;3>e;e+=1){n=i[e];try{t=new window.ActiveXObject(n)}catch(o){}}return t}var o=t("signals");n.prototype={add:function(t,e){var i=new n.Loader(t,e);return i.webAudioContext=this.webAudioContext,i.crossOrigin=this.crossOrigin,i.touchLocked=this.touchLocked,this.queue.push(i),this.numTotal++,i},start:function(){this.numTotal=this.queue.length,this.next()},next:function(){if(0===this.queue.length)return this.loaded=!0,void this.onComplete.dispatch(this.loaders);var t=this.queue.pop(),e=this;t.onComplete.addOnce(function(){e.numLoaded++,e.onProgress.getNumListeners()>0&&e.onProgress.dispatch(e.numLoaded/e.numTotal),e.loaders[t.url]=t,e.onChildComplete.dispatch(t),e.next()}),t.onError.addOnce(function(){e.onError.dispatch(t),e.next()}),t.start()},addMultiple:function(t){for(var e=0;e<t.length;e++)this.add(t[e])},get:function(t){return this.loaders[t]}},n.Loader=function(t,e){this.url=t,this.type=e||this.url.split("?")[0].toLowerCase().split(".").pop(),this.onComplete=new o.Signal,this.onError=new o.Signal,this.onProgress=new o.Signal,this.webAudioContext=null,this.crossOrigin=!1,this.touchLocked=!1},n.Loader.prototype={start:function(){switch(this.type){case"mp3":case"ogg":this.loadAudio(this.webAudioContext,this.touchLocked);break;case"jpg":case"png":case"gif":this.loadImage(this.crossOrigin);break;case"json":this.loadJSON();break;default:throw"ERROR: Unknown type for file with URL: "+this.url}},loadAudio:function(t,e){t?this.loadWebAudio(t):this.loadHTML5Audio(e)},loadWebAudio:function(t){var e=new XMLHttpRequest;e.open("GET",this.url,!0),e.responseType="arraybuffer";var n=this;e.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total;n.onProgress.dispatch(e)}},e.onload=function(){t.decodeAudioData(e.response,function(t){n.data=t,n.onComplete.dispatch(t)},function(){n.onError.dispatch()})},e.onerror=function(){n.onError.dispatch()},e.send(),this.request=e},loadHTML5Audio:function(t){var e=new Audio;this.data=e,e.name=this.url,e.preload="auto";var n=this;if(e.src=this.url,t)this.onProgress.dispatch(1),this.onComplete.dispatch(this.data);else{var i=function(){e.removeEventListener("canplaythrough",i),clearTimeout(o),n.onProgress.dispatch(1),n.onComplete.dispatch(n.data)},o=setTimeout(i,2e3);e.addEventListener("canplaythrough",i,!1),e.onerror=function(){clearTimeout(o),n.onError.dispatch()},e.load()}},loadImage:function(t){var e=new Image;this.data=e,e.name=this.url;var n=this;e.onload=function(){n.onComplete.dispatch(n.data)},e.onerror=function(){n.onError.dispatch()},t&&(e.crossOrigin="anonymous"),e.src=this.url,this.request=e},loadJSON:function(){function t(){return n.status>=400?void o.onError.dispatch():(o.json=o.data=JSON.parse(n.responseText),void o.onComplete.dispatch(o.data))}function e(){o.onError.dispatch()}var n=i();n.open("GET",this.url,!0),n.responseType="text";var o=this;"onload"in n&&"onerror"in n?(n.onload=t,n.onerror=e):n.onreadystatechange=function(){try{if(void 0!==this.done)return;this.status>=200&&this.status<300&&(this.done=!0,t()),this.status>=400&&(this.done=!0,e())}catch(n){}},n.send(),this.request=n},cancel:function(){this.request&&4!==this.request.readyState&&this.request.abort()}},"object"==typeof e&&e.exports&&(e.exports=n)},{signals:1}],4:[function(t,e){"use strict";function n(){this.webAudioContext=i.createContext(),this._sounds={},this._delayTimeouts=[],this._ext=void 0,this._isSupported=void 0,this._touchLocked=!1,this._queued=[],s.onPageHidden.add(function(){this.pauseAll()},this),s.onPageShown.add(function(){this.resumeAll()},this)}var i=t("./web-audio.js"),o=t("./html-audio.js"),s=t("./visibility.js");n.prototype={add:function(t,e,n){var s=this.webAudioContext&&!e.tagName?new i(this.webAudioContext):new o;return s.loop=!!n,s.add(e),this._sounds[t]=s,s},getExtension:function(){if(!this._ext){var t=document.createElement("audio");this._ext=t.canPlayType('audio/ogg; codecs="vorbis"')?".ogg":".mp3"}return this._ext},isSupported:function(){if(void 0===this._isSupported)try{var t=document.createElement("audio");this._isSupported=!(!t||!t.canPlayType('audio/ogg; codecs="vorbis"')&&!t.canPlayType("audio/mpeg;"))}catch(e){this._isSupported=!1}return this._isSupported},webAudioSupported:function(){return!!this.webAudioContext},get:function(t){return this._sounds[t]},play:function(t,e,n){if(this._touchLocked)return void this.queueUp(t,e,n);var i=this._sounds[t];if(i)if(void 0!==n&&(i.loop=n),void 0!==e&&e>0){var o=setTimeout(function(){i.play()},e);this._delayTimeouts.push(o)}else i.play()},mute:function(){for(var t in this._sounds)this._sounds[t].volume=0},unMute:function(){for(var t in this._sounds)this._sounds[t].volume=1},pause:function(t){this._sounds[t]&&this._sounds[t].pause()},stop:function(t){this._sounds[t]&&this._sounds[t].stop()},pauseAll:function(){for(var t in this._sounds)this._sounds[t].playing&&this._sounds[t].pause()},resumeAll:function(){for(var t in this._sounds)this._sounds[t].paused&&this._sounds[t].play()},stopAll:function(){for(var t in this._sounds)this._sounds[t].stop();for(var e=0;e<this._delayTimeouts.length;e++)clearTimeout(this._delayTimeouts[e]);this._delayTimeouts.length=0},getTouchLocked:function(){return this._touchLocked},setTouchLocked:function(t){this._touchLocked=t;var e=this,n=function(){e._touchLocked=!1,document.body.removeEventListener("touchstart",n);for(var t=0;t<e._queued.length;t++)e._queued[t]();e._queued.length=0};this._touchLocked&&document.body.addEventListener("touchstart",n,!1)},queueUp:function(t,e,n){var i=this,o=function(){i.play(t,e,n)};this._queued.push(o)}},"object"==typeof e&&e.exports&&(e.exports=n)},{"./html-audio.js":10,"./visibility.js":32,"./web-audio.js":33}],5:[function(t,e){"use strict";function n(){this._position=i.get(),this._velocity=i.get(),this._steeringForce=i.get(),this._bounds={x:0,y:0,width:640,height:480},this._edgeBehavior=n.EDGE_BOUNCE,this._mass=1,this._maxSpeed=10,this._maxForce=1,this._arrivalThreshold=50,this._wanderDistance=10,this._wanderRadius=5,this._wanderAngle=0,this._wanderRange=1,this._avoidDistance=300,this._avoidBuffer=20,this._pathIndex=0,this._pathThreshold=20,this._inSightDistance=300,this._tooCloseDistance=60}var i=t("./vec2.js");n.EDGE_WRAP="wrap",n.EDGE_BOUNCE="bounce",n.prototype.setBounds=function(t,e,n,i){this._bounds.width=t,this._bounds.height=e,this._bounds.x=n||0,this._bounds.y=i||0},n.prototype.update=function(){this._steeringForce.truncate(this._maxForce),this._steeringForce.divideBy(this._mass),this._velocity=this._velocity.add(this._steeringForce,!0),this._steeringForce.reset(),this._velocity.truncate(this._maxSpeed),this._position=this._position.add(this._velocity,!0),this._edgeBehavior===n.EDGE_WRAP?this.wrap():this._edgeBehavior===n.EDGE_BOUNCE&&this.bounce()},n.prototype.bounce=function(){this._position.x>this._bounds.width?(this._position.x=this._bounds.width,this._velocity.x*=-1):this._position.x<this._bounds.x&&(this._position.x=this._bounds.x,this._velocity.x*=-1),this._position.y>this._bounds.height?(this._position.y=this._bounds.height,this._velocity.y*=-1):this._position.y<this._bounds.y&&(this._position.y=this._bounds.y,this._velocity.y*=-1)},n.prototype.wrap=function(){this._position.x>this._bounds.width?this._position.x=this._bounds.x:this._position.x<this._bounds.x&&(this._position.x=this._bounds.width),this._position.y>this._bounds.height?this._position.y=this._bounds.y:this._position.y<this._bounds.y&&(this._position.y=this._bounds.height)},n.prototype.seek=function(t){var e=t.subtract(this._position);e.normalize(),e.scaleBy(this._maxSpeed);var n=e.subtract(this._velocity,!0);this._steeringForce=this._steeringForce.add(n,!0),n.dispose()},n.prototype.flee=function(t){var e=t.subtract(this._position);e.normalize(),e.scaleBy(this._maxSpeed);var n=e.subtract(this._velocity,!0);this._steeringForce=this._steeringForce.subtract(n,!0),n.dispose()},n.prototype.arrive=function(t){var e=t.subtract(this._position);e.normalize();var n=this._position.distance(t);if(n>this._arrivalThreshold)e.scaleBy(this._maxSpeed);else{var i=this._maxSpeed*n/this._arrivalThreshold;e.scaleBy(i)}var o=e.subtract(this._velocity,!0);this._steeringForce=this._steeringForce.add(o,!0),o.dispose()},n.prototype.pursue=function(t){var e=this._position.distance(t._position)/this._maxSpeed,n=t._velocity.clone().scaleBy(e),i=t._position.add(n);this.seek(i),n.dispose(),i.dispose()},n.prototype.evade=function(t){var e=this._position.distance(t._position)/this._maxSpeed,n=t._velocity.clone().scaleBy(e),i=t._position.add(n);this.flee(i),i.dispose()},n.prototype.wander=function(){var t=this._velocity.clone().normalize().scaleBy(this._wanderDistance),e=i.get();e.length=this._wanderRadius,e.angle=this._wanderAngle,this._wanderAngle+=Math.random()*this._wanderRange-.5*this._wanderRange;var n=t.add(e,!0);this._steeringForce=this._steeringForce.add(n,!0),e.dispose(),n.dispose()},n.prototype.avoid=function(t){for(var e=t.length,n=0;e>n;n++){var i=t[n],o=this._velocity.clone().normalize(),s=i.position.subtract(this._position),r=s.dotProduct(o);if(r>0){var a=o.clone().scaleBy(this._avoidDistance),c=o.clone().scaleBy(r),u=c.subtract(s),h=u.length;if(h<i.radius+this._avoidBuffer&&c.length<a.length){var d=o.clone().scaleBy(this._maxSpeed);d.angle+=s.sign(this._velocity)*Math.PI/2,d.scaleBy(1-c.length/a.length),this._steeringForce=this._steeringForce.add(d,!0),this._velocity.scaleBy(c.length/a.length),d.dispose()}a.dispose(),c.dispose(),u.dispose()}o.dispose(),s.dispose()}},n.Circle=function(t,e,n){this.radius=t,this.position=i.get(e,n)},n.prototype.followPath=function(t,e){e=void 0===e?!1:e;var n=t[this._pathIndex];n&&(this._position.distance(n)<this._pathThreshold&&(this._pathIndex>=t.length-1?e&&(this._pathIndex=0):this._pathIndex++),this._pathIndex>=t.length-1&&!e?this.arrive(n):this.seek(n))},n.prototype.flock=function(t){for(var e=this._velocity.clone(),n=i.get(),o=0,s=t.length,r=0;s>r;r++){var a=t[r];a!==this&&this._inSight(a)&&(e=e.add(a._velocity,!0),n=n.add(a._position,!0),this._tooClose(a)&&this.flee(a._position),o++)}o>0&&(e.divideBy(o),n.divideBy(o),this.seek(n),this._steeringForce.add(e.subtract(this._velocity,!0),!0)),e.dispose(),n.dispose()},n.prototype._inSight=function(t){if(this._position.distance(t._position)>this._inSightDistance)return!1;var e=this._velocity.clone().normalize(),n=t._position.subtract(this._position),i=n.dotProduct(e);return e.dispose(),n.dispose(),0>i?!1:!0},n.prototype._tooClose=function(t){return this._position.distance(t._position)<this._tooCloseDistance},Object.defineProperty(n.prototype,"position",{get:function(){return this._position}}),Object.defineProperty(n.prototype,"velocity",{get:function(){return this._velocity}}),Object.defineProperty(n.prototype,"edgeBehavior",{get:function(){return this.__edgeBehavior},set:function(t){this._edgeBehavior=t}}),"object"==typeof e&&e.exports&&(e.exports=n)},{"./vec2.js":29}],6:[function(t,e){"use strict";function n(){return!!_.match(/Android/i)}function i(){return!!(n()&&parseFloat(_.slice(_.indexOf("Android")+8))<4)}function o(){if(!n())return!1;var t=new RegExp(/AppleWebKit\/([\d.]+)/),e=t.exec(_),i=null===e?null:parseFloat(t.exec(_)[1]),o=null!==i&&537>i;return o}function s(){return void 0!==window.devicePixelRatio?window.devicePixelRatio:1}function r(){var t=document.createElement("div");return t.innerHTML="<!--[if lte IE 8]><i></i><![endif]-->",1===t.getElementsByTagName("i").length}function a(){var t=document.createElement("div");return t.innerHTML="<!--[if IE]><i></i><![endif]-->",1===t.getElementsByTagName("i").length}function c(){var t,e,n=-1;return"Microsoft Internet Explorer"===navigator.appName?(e=e,t=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==t.exec(e)&&(n=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(e=e,t=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==t.exec(e)&&(n=parseFloat(RegExp.$1))),n}function u(){return!!_.match(/OS 5(_\d)+ like Mac OS X/i)}function h(){return!!_.match(/iPad/i)}function d(){return!!_.match(/iPhone/i)}function l(){return!!_.match(/iPod/i)}function p(){return h()||l()||d()}function f(){return!!_.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)}function g(){return Math.max(window.outerHeight,window.screen.height)}function v(){return Math.max(window.outerWidth,window.screen.width)}var _=navigator.userAgent,m={android:n(),androidOld:i(),androidStock:o(),dpr:s(),ie8down:r(),ie9down:a(),ieVersion:c(),ios:p(),ios5:u(),ipad:h(),iphone:d(),ipod:l(),mobile:f(),retina:s()>1,screenHeight:g(),screenWidth:v()};"object"==typeof e&&e.exports&&(e.exports=m)},{}],7:[function(t,e){"use strict";function n(t){function e(){t.innerHTML="FPS: "+s+"<br />AVE: "+r}function n(t){void 0===t&&(t=Date.now()),0===i&&(i=t),t-1e3>i&&(i=t,s=o,o=0,s>1&&(a++,c+=s,r=Math.floor(c/a)),e()),o++}var i=0,o=0,s=0,r=0,a=0,c=0;return t||(t=document.createElement("div"),t.setAttribute("id","fps"),t.style.position="absolute",t.style.top="0px",t.style.right="0px",t.style.padding="2px 6px",t.style.zIndex="9999",t.style.background="#000",t.style.color="#fff",document.body.appendChild(t)),{update:n}}"object"==typeof e&&e.exports&&(e.exports=n)},{}],8:[function(t,e){"use strict";var n=t("signals"),i=function(){function t(){s.dispatch(e.isFullscreen())}var e,i=document.documentElement,o=!!(i.requestFullScreen||i.webkitRequestFullScreen||i.mozRequestFullScreen),s=new n.Signal;return o&&(document.addEventListener("fullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("webkitfullscreenchange",t)),e={isSupported:o,onChange:s,enter:function(t){t=t||document.documentElement;var e=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen;e&&e.call(t)},exit:function(){var t=document.exitFullscreen||document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen;t&&t.call(document)},toggle:function(t){this.isFullscreen()?this.exit():this.enter(t)},isFullscreen:function(){return!!(document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen)}}}();"object"==typeof e&&e.exports&&(e.exports=i)},{signals:1}],9:[function(t,e){"use strict";function n(t){this.init(t)}n.prototype={init:function(t){t?(this.canvas=t,this.size(this.canvas.width,this.canvas.height)):document.querySelector("canvas")?(this.canvas=document.querySelector("canvas"),this.size(this.canvas.width,this.canvas.height)):(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.size()),this.context=this.canvas.getContext("2d"),this._textFont="Times",this._textSize=12,this.context.font=this._textSize+"px "+this._textFont},size:function(t,e){this.width=this.canvas.width=t||window.innerWidth,this.height=this.canvas.height=e||window.innerHeight},clear:function(t){t?(this.context.fillStyle=t,this.context.fillRect(0,0,this.width,this.height)):this.context.clearRect(0,0,this.width,this.height)},background:function(t,e,n){this.clear("rgb("+t+", "+n+", "+e+")")},fill:function(t,e,n,i){return"string"==typeof t?void(this.context.fillStyle=t):(i=void 0===i?1:i,void(this.context.fillStyle="rgba("+t+", "+n+", "+e+", "+i+")"))},stroke:function(t,e,n,i){i=void 0===i?1:i,this.context.strokeStyle="rgba("+t+", "+n+", "+e+", "+i+")"},strokeWeight:function(t){this.context.lineWidth=t},move:function(t,e){this.context.moveTo(t,e)},line:function(t,e,n,i){this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(n,i),this.context.stroke()},rect:function(t,e,n,i,o){void 0!==o&&0!==o?(this.context.save(),this.context.translate(t+n/2,e+i/2),this.context.rotate(o),this.context.rect(-n/2,-i/2,n,i),this.context.fill(),this.context.stroke(),this.context.restore()):(this.context.rect(t,e,n,i),this.context.fill(),this.context.stroke())},circle:function(t,e,n){this.context.beginPath(),this.context.arc(t,e,n,0,2*Math.PI,!1),this.context.fill(),this.context.stroke()},triangle:function(t,e,n,i,o){void 0!==o&&0!==o?(this.context.save(),this.context.translate(t,e),this.context.rotate(o),this.context.beginPath(),this.context.moveTo(0-n/2,0+i/2),this.context.lineTo(0,0-i/2),this.context.lineTo(0+n/2,0+i/2),this.context.closePath(),this.context.stroke(),this.context.fill(),this.context.restore()):(this.context.beginPath(),this.context.moveTo(t-n/2,e+i/2),this.context.lineTo(t,e-i/2),this.context.lineTo(t+n/2,e+i/2),this.context.closePath(),this.context.stroke(),this.context.fill())},triangleABC:function(t,e,n,i,o,s){this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(n,i),this.context.lineTo(o,s),this.context.closePath(),this.context.stroke(),this.context.fill()},image:function(t,e,n,i){if(void 0!==i&&0!==i){var o=t.width/2,s=t.height/2;this.context.save(),this.context.translate(e+o,n+s),this.context.rotate(i),this.context.drawImage(t,-o,-s),this.context.restore()}else this.context.drawImage(t,e,n)},cross:function(t){this.context.beginPath(),this.context.moveTo(-t,-t),this.context.lineTo(t,t),this.context.moveTo(-t,t),this.context.lineTo(t,-t),this.context.stroke()},text:function(t,e,n){this.context.fillText(t,e,n)},textFont:function(t){this._textFont=t,this.context.font=this._textSize+"px "+t},textSize:function(t){this._textSize=t,this.context.font=t+"px "+this._textFont},openImage:function(){var t=window.open("","Canvas Image"),e=this.canvas.toDataURL("image/png");t.document.write('<img src="'+e+'" width="'+this.width+'" height="'+this.height+'" />')},downloadImage:function(){var t=this.canvas.toDataURL("image/png").replace("image/png","image/octet-stream");window.location.href=t}},"object"==typeof e&&e.exports&&(e.exports=n)},{}],10:[function(t,e){"use strict";function n(){this._sound=null,this._loop=!1,this._volume=1,this._playing=!1,this._paused=!1}n.prototype={add:function(t){return this._sound=t,this._sound},play:function(){void 0!==this._sound.volume&&(this._sound.volume=this._volume),this._sound.play(),this._playing=!0,this._paused=!1;var t=this;this._sound.addEventListener("ended",function(){t._loop?(this.currentTime=0,this.play()):t._playing=!1},!1)},pause:function(){this._sound.pause(),this._playing=!1,this._paused=!0},stop:function(){this._sound.pause(),this._playing=!1,this._paused=!1}},Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t}}),Object.defineProperty(n.prototype,"volume",{get:function(){return this._volume},set:function(t){isNaN(t)||(this._volume=t,this._sound&&void 0!==this._sound.volume&&(this._sound.volume=this._volume))}}),Object.defineProperty(n.prototype,"playing",{get:function(){return this._playing}}),Object.defineProperty(n.prototype,"paused",{get:function(){return this._paused}}),Object.defineProperty(n.prototype,"sound",{get:function(){return this._sound}}),"object"==typeof e&&e.exports&&(e.exports=n)},{}],11:[function(t,e){"use strict";function n(){var t,e=function(){var e;return e="number"==typeof window.pageXOffset?function(e){var n=e.clientX||0,i=e.clientY||0,o=window.pageXOffset,s=window.pageYOffset;t.x=n+o,t.y=i+s,t.percentX=t.x/window.innerWidth,t.percentY=t.y/window.innerHeight}:function(e){e=e&&e.clientX?e:window.event;var n=e.clientX,i=e.clientY,o=document.documentElement,s=document.body,r=Math.max(o.scrollLeft,s.scrollLeft),a=Math.max(o.scrollTop,s.scrollTop);t.x=n+r,t.y=i+a,t.percentX=t.x/window.innerWidth,t.percentY=t.y/window.innerHeight}}();return t={x:0,y:0,percentX:0,percentY:0,isListening:!1,listen:function(n){return n?(document.body.addEventListener("mousemove",e),document.body.addEventListener("touchmove",e)):(document.body.removeEventListener("mousemove",e),document.body.removeEventListener("touchmove",e)),t.isListening=n,this}}}"object"==typeof e&&e.exports&&(e.exports=n)},{}],12:[function(t,e){"use strict";function n(){function t(t){t.preventDefault(),n[t.keyCode]=!0}function e(t){t.preventDefault(),n[t.keyCode]=!1}for(var n=[],o=0;256>o;o++)n.push(!1);var s={on:function(){document.addEventListener("keydown",t,!1),document.addEventListener("keyup",e,!1)},off:function(){document.removeEventListener("keydown",t,!1),document.removeEventListener("keyup",e,!1)},isDown:function(t){return n[t]},left:function(){return n[i.LEFT]||n[i.A]},right:function(){return n[i.RIGHT]||n[i.D]},up:function(){return n[i.UP]||n[i.W]},down:function(){return n[i.DOWN]||n[i.S]},space:function(){return n[i.SPACEBAR]}};return s.on(),s}var i=t("./keyboard.js");"object"==typeof e&&e.exports&&(e.exports=n)},{"./keyboard.js":13}],13:[function(t,e){var n={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,UNDERSCORE:189,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};"object"==typeof e&&e.exports&&(e.exports=n)},{}],14:[function(){"use strict";!function(t){window.console=window.console||{log:t,warn:t,error:t,table:t},window.console.table=window.console.table||t}(function(){})},{}],15:[function(t,e){"use strict";var n=function(t,e){return t.classList?t.classList.contains(e):t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},i=function(t,e){if(t.classList)t.classList.remove(e);else if(n(t,e)){var i=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ")}},o=function(t,e){i(t,e),t.classList?t.classList.add(e):t.className+=" "+e},s=function(t,e){t.classList?t.classList.toggle(e):n(t,e)?i(t,e):o(t,e)},r={addClass:o,hasClass:n,removeClass:i,toggleClass:s};"object"==typeof e&&e.exports&&(e.exports=r)},{}],16:[function(t,e){"use strict";var n=function(t,e){return t||(t=window.event),t.srcElement&&(t.target=t.srcElement,t.currentTarget=e,t.preventDefault=function(){t.returnValue=!1},t.stopPropagation=function(){t.cancelBubble=!0}),t},i=function(){return document.addEventListener?function(t,e,n){t.addEventListener(e,n,!1)}:function(t,e,i){t.attachEvent("on"+e,function(e){e=n(e,t),i(e)})}}(),o=function(){return document.addEventListener?function(t,e,n){t.removeEventListener(e,n,!1)}:function(t,e,n){t.detachEvent("on"+e,n)}}(),s={addEvent:i,removeEvent:o};"object"==typeof e&&e.exports&&(e.exports=s)},{}],17:[function(t,e){"use strict";function n(){function t(t){if(s){for(var e=s;e.next;)e=e.next;n(t,e)}else s=r=t;return t}function e(t){return t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t===s&&(s=t.next),t===r&&(r=t.prev),t.next=t.prev=null,t}function n(t,n){return e(t),t.prev=n,t.next=n.next,n.next?n.next.prev=t:r=t,n.next=t,t}function i(t,n){return e(t),t.prev=n.prev,t.next=n,n.prev?n.prev.next=t:s=t,n.prev=t,t}function o(t,e){if(s){var n=Array.prototype.splice.call(arguments,2);n.unshift(null);for(var i=s;i;)n[0]=i,t.apply(e,n),i=i.next}}var s,r;return{getFirst:function(){return s},getLast:function(){return r},getCount:function(){for(var t=0,e=s;e;)t++,e=e.next;return t},add:t,remove:e,insertAfter:n,insertBefore:i,forEach:o}}"object"==typeof e&&e.exports&&(e.exports=n)},{}],18:[function(t,e){"use strict";var n=180/Math.PI,i=Math.PI/180,o={angle:function(t,e,n,i){var o=n-t,s=i-e;return Math.atan2(s,o)},clamp:function(t,e,n){if(e>n){var i=e;e=n,n=i}return e>t?e:t>n?n:t},coinToss:function(){return Math.random()>.5},crossProduct:function(t,e,n,i){return t*i-e*n},degrees:function(t){return t*n},difference:function(t,e){return Math.abs(t-e)},distance:function(t,e,n,i){var s=o.distanceSQ(t,e,n,i);return Math.sqrt(s)},distanceSQ:function(t,e,n,i){var o=t-n,s=e-i;return o*o+s*s},dotProduct:function(t,e,n,i){return t*n+e*i},getCirclePoints:function(t,e,n,i,o,s){o=void 0===o?-Math.PI/2:o;for(var r,a=[],c=2*Math.PI,u=c/i,h=o;c+o>h;h+=u)r=void 0===s?{}:new s,r.x=t+n*Math.cos(h),r.y=e+n*Math.sin(h),a.push(r);return a},getIntersectionArea:function(t,e,n,i,o,s,r,a){var c=Math.max(0,Math.min(t+n,o+r)-Math.max(t,o)),u=Math.max(0,Math.min(e+i,s+a)-Math.max(e,s));return c*u},getOverlapX:function(t,e,n,i){return Math.max(0,Math.min(t+e,n+i)-Math.max(t,n))},getOverlapY:function(t,e,n,i){return Math.max(0,Math.min(t+e,n+i)-Math.max(t,n))},lerp:function(t,e,n){return t+(e-t)*n},map:function(t,e,n,i,o){return t===e?i:(t-e)*(o-i)/(n-e)+i},radians:function(t){return t*i},random:function(t,e){return isNaN(e)&&(e=t,t=0),t+Math.random()*(e-t)},rotateToDEG:function(t,e){var n=(e-t)%360;return n!==n%180&&(n=0>n?n+360:n-360),t+n},rotateToRAD:function(t,e){var n=2*Math.PI,i=(e-t)%n;return i!==i%Math.PI&&(i=0>i?i+n:i-n),t+i},roundToNearest:function(t,e){return Math.round(t/e)*e}};"object"==typeof e&&e.exports&&(e.exports=o)},{}],19:[function(t,e){"use strict";function n(t){var e=[];return{getPool:function(){return e},get:function(){return e.length>0?e.pop():new t},dispose:function(t){e.push(t)},fill:function(n){for(;e.length<n;)e[e.length]=new t},empty:function(){e=[]}}}"object"==typeof e&&e.exports&&(e.exports=n)},{}],20:[function(t,e){"use strict";var n=function(t,e,n,i){var o=(screen.width-n)/2,s=(screen.height-i)/2,r="width="+n+", height="+i+", top="+s+", left="+o+", directories=no, location=no, menubar=no, resizable=no, scrollbars=no, status=no, toolbar=no",a=window.open(t,e,r);return null===a||"undefined"==typeof a?!1:(window.focus&&a.focus(),!0)};"object"==typeof e&&e.exports&&(e.exports=n)},{}],21:[function(){"use strict";!function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}()},{}],22:[function(t,e){"use strict";var n;n=document.addEventListener?function(t,e){"complete"===document.readyState||"interactive"===document.readyState?t.call(e||this):document.addEventListener("DOMContentLoaded",function(){t.call(e||this)})}:function(t,e){"interactive"===document.readyState&&t.call(e||this),document.attachEvent("onreadystatechange",function(){"interactive"===document.readyState&&t.call(e||this)})},"object"==typeof e&&e.exports&&(e.exports=n)},{}],23:[function(t,e){"use strict";var n=function(t,e,n,i,o){var s,r=t.width,a=t.height;switch(o){case"fill":s=Math.max(e/r,n/a);
break;case"fit":s=Math.min(e/r,n/a);break;case"fitWidth":s=e/r;break;case"fitHeight":s=n/a;break;default:s=Math.max(e/r,n/a)}t.width=Math.ceil(r*s),t.height=Math.ceil(a*s),i&&(t.x=Math.round(.5*(e-t.width)),t.y=Math.round(.5*(n-t.height)))};"object"==typeof e&&e.exports&&(e.exports=n)},{}],24:[function(t,e){"use strict";function n(t){"http"!==t.substr(0,4)}var i=t("./popup.js"),o={facebook:function(t){return i("http://www.facebook.com/share.php?u="+encodeURIComponent(t),"shareFacebook",720,480)},twitter:function(t,e,n,o){return i("https://twitter.com/intent/tweet?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(e)+"&hashtags="+encodeURIComponent(n)+"&related="+encodeURIComponent(o),"shareTwitter",550,380)},googlePlus:function(t){return i("https://plus.google.com/share?url="+encodeURIComponent(t),"shareGooglePlus",550,380)},pinterest:function(t,e,o){return n(e),i("http://pinterest.com/pin/create/button/?url="+encodeURIComponent(t)+"&media="+encodeURIComponent(e)+"&description="+encodeURIComponent(o),"sharePinterest",630,280)},vkontakte:function(t,e,n,o){return i("http://vkontakte.ru/share.php?url="+encodeURIComponent(t)+"&title="+e+"&description="+n+"&image="+encodeURIComponent(o),"shareVK",550,380)},renren:function(t,e){return i("http://share.renren.com/share/buttonshare.do?link="+encodeURIComponent(t)+"&title="+e,"shareRenRen",900,480)},weibo:function(t,e,n){return i("http://service.weibo.com/share/share.php?url="+encodeURIComponent(t)+"&appkey=&title="+e+"&pic="+encodeURIComponent(n)+"&ralateUid=&language=zh_cn","shareWeibo",640,480)},facebookFeedDialog:function(t,e,o,s,r,a,c,u){n(s),n(u);var h="http://www.facebook.com/dialog/feed?app_id="+t+"&picture="+s+(r&&""!==r?"&source="+r:"")+"&name="+encodeURIComponent(e)+"&link="+o+"&caption="+encodeURIComponent(a)+"&description="+encodeURIComponent(c)+"&display=popup&show_error=true&redirect_uri="+u;return i(h,"shareFacebook",550,380)}};"object"==typeof e&&e.exports&&(e.exports=o)},{"./popup.js":20}],25:[function(t,e){"use strict";function n(){this._states={},this._initial=null,this._currentState=null,this._previousState=null,this._cancelled=null,this._hasChanged=!1,this._actionQueue=[],this._history=[],this._factory=new n.Factory(this),this._onChange=new i.Signal}var i=i||t("signals");n.prototype={start:function(){if(!this._initial)throw"State Machine cannot start. No states defined.";this._transitionTo(this._initial,null)},action:function(t,e){if(!this._hasChanged)return void this._actionQueue.push({action:t,data:e});if(!this._currentState||this._currentState.getTarget(t)!==this._currentState.name){var n=this._currentState.getTarget(t),i=this._states[n];i&&this._transitionTo(i,e)}},_transitionTo:function(t,e){if(this._hasChanged=!1,null!==t){if(this._cancelled=!1,this._currentState&&this._currentState.onExit.getNumListeners()>0&&this._currentState.onExit.dispatch(e),this._cancelled)return void(this._cancelled=!1);if(t.onEnter.getNumListeners()>0&&t.onEnter.dispatch(e),this._cancelled)return void(this._cancelled=!1);this._currentState&&(this._previousState=this._currentState,this._history.push(this._previousState.name)),this._currentState=t,t.onChange.getNumListeners()>0&&t.onChange.dispatch(e),this._onChange.dispatch(this._currentState.name,e),this._hasChanged=!0,this._processActionQueue()}},_processActionQueue:function(){if(this._actionQueue.length>0){var t=this._actionQueue.shift();this._currentState.getTarget(t.action)?this.action(t.action,t.data):this._processActionQueue()}},cancel:function(){this._cancelled=!0},addState:function(t,e){return null===t||this._states[t.name]?null:(this._states[t.name]=t,e&&(this._initial=t),t)},removeState:function(t){var e=this._states[t];null!==e&&(this._states[t]=null)},getState:function(t){return this._states[t]}},Object.defineProperty(n.prototype,"onChange",{get:function(){return this._onChange}}),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState}}),Object.defineProperty(n.prototype,"previousState",{get:function(){return this._previousState}}),Object.defineProperty(n.prototype,"states",{get:function(){return this._states}}),Object.defineProperty(n.prototype,"initial",{get:function(){return this._initial}}),Object.defineProperty(n.prototype,"history",{get:function(){return this._history}}),Object.defineProperty(n.prototype,"factory",{get:function(){return this._factory}}),n.State=function(t){this._transitions={},this._name=t,this._onChange=new i.Signal,this._onEnter=new i.Signal,this._onExit=new i.Signal},n.State.prototype={addTransition:function(t,e){this.getTarget(t)||(this._transitions[t]=e)},removeTransition:function(t){this._transitions[t]=null},getTarget:function(t){return this._transitions[t]}},Object.defineProperty(n.State.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(n.State.prototype,"transitions",{get:function(){return this._transitions}}),Object.defineProperty(n.State.prototype,"onChange",{get:function(){return this._onChange}}),Object.defineProperty(n.State.prototype,"onEnter",{get:function(){return this._onEnter}}),Object.defineProperty(n.State.prototype,"onExit",{get:function(){return this._onExit}}),n.Factory=function(t){this.fsm=t},n.Factory.prototype={add:function(t){var e=new n.State(t.name),i=t.transitions;if(i)for(var o=0;o<i.length;o++)e.addTransition(i[o].action,i[o].target),"function"==typeof t.onChange&&e.onChange.add(t.onChange),"function"==typeof t.onEnter&&e.onEnter.add(t.onEnter),"function"==typeof t.onExit&&e.onExit.add(t.onExit);var s=0===this.getTotal()||t.initial;this.fsm.addState(e,s)},addMultiple:function(t){for(var e=0;e<t.length;e++)this.add(t[e])},create:function(t,e,i){var o=new n.State(t);if(void 0!==e)for(var s=0;s<e.length;s++)o.addTransition(e[s].action,e[s].target);return this.fsm.addState(o,i),o},getTotal:function(){var t=0;for(var e in this.fsm.states)this.fsm.states.hasOwnProperty(e)&&null!==this.fsm.states[e]&&t++;return t}},n.DebugView=function(t){function e(t){for(var e=i.querySelectorAll("div"),n=0;n<e.length;n++)e[n].style.display=e[n].getAttribute("data-state")===t?"block":"none"}function n(e){var n=document.createElement("button");return n.setAttribute("data-action",e),n.addEventListener("click",function(){var e=this.getAttribute("data-action");t.action(e)}),n.innerHTML=e,n}var i=document.createElement("div");for(var o in t.states){var s=t.states[o],r=document.createElement("div");r.setAttribute("data-state",s.name),r.style.display="none";var a=document.createElement("h3");a.innerHTML="State: "+s.name,r.appendChild(a);var c=s.transitions;if(c)for(var u in c)c.hasOwnProperty(u)&&r.appendChild(n(u));i.appendChild(r)}return t.onChange.add(function(t){e(t)}),t.currentState&&e(t.currentState.name),i},"object"==typeof e&&e.exports&&(e.exports=n)},{signals:1}],26:[function(t,e){"use strict";var n={saveJSON:function(t,e){return localStorage?(localStorage.setItem(t,JSON.stringify(e)),!0):!1},loadJSON:function(t){return localStorage&&localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):null},getImageDataURL:function(t,e,n){this.canvas||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")),this.canvas.width=e||t.width,this.canvas.height=n||t.height,this.context.drawImage(t,0,0);var i=this.canvas.toDataURL("image/png");return this.context.clearRect(0,0,e,n),i}};"object"==typeof e&&e.exports&&(e.exports=n)},{}],27:[function(t,e){"use strict";function n(t){return t.replace(/(\]|\[|\{|\}|\(|\)|\*|\+|\?|\.|\\)/g,"\\$1")}function i(t){return t.replace(/^\s+|\s+$/g,"")}function o(t){return t.replace(/^\s+/,"")}function s(t){return t.replace(/\s+$/,"")}function r(t,e,n){for(;t.length<n;)t=e+t;return t}function a(t,e,n){for(;t.length<n;)t+=e;return t}function c(t){var e=i(t);return e.replace(/\s+/g," ")}function u(t,e,i){var o=n(e),s=i?"g":"ig";return t.replace(new RegExp(o,s),"")}function h(t,e,n){void 0===n&&(n="..."),e-=n.length;var i=t;if(i.length>e){i=i.substr(0,e);var o=/[^\s]/;o.test(t.charAt(e))&&(i=s(i.replace(/\w+$|\s+$/,""))),i+=n}return i}function d(t,e){var n=o(t);return e?n.replace(/^.|\b./g,function(t){return t.toUpperCase()}):n.replace(/(^\w)/,function(t){return t.toUpperCase()})}function l(t){var e=t.toLowerCase().replace(/\b([^.?;!]+)/,d);return e.replace(/\b[i]\b/,"I")}function p(t){return t.split("").reverse().join("")}function f(t){return t.split(" ").reverse().join(" ")}function g(t){return t.replace(/<\/?[^>]+>/gim,"")}function v(t){return t.replace(/(\w)/,function(t){var e=t.toLowerCase(),n=t.toUpperCase();switch(t){case e:return n;case n:return e;default:return t}})}function _(t,e){return-1!==t.indexOf(e)}function m(t,e,i){var o=n(e),s=i?"g":"ig";return t.match(new RegExp(o,s)).length}function y(t,e){return t.lastIndexOf(e)===t.length-e.length}function x(t){var e=c(t);return!!e.length}function b(t){return!t.length}function w(t){var e=/^[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?$/;return e.test(t)}function E(t){return t.match(/\b\w+\b/g).length}function A(t,e){var n=t.indexOf(e);return-1===n?"":(n+=e.length,t.substr(n))}function S(t,e){var n=t.lastIndexOf(e);return-1===n?"":(n+=e.length,t.substr(n))}function C(t,e){return 0===t.indexOf(e)}function j(t,e){var n=t.indexOf(e);return-1===n?"":t.substr(0,n)}function T(t,e){var n=t.lastIndexOf(e);return-1===n?"":t.substr(0,n)}function P(t,e,n){var i="",o=t.indexOf(e);if(-1!==o){o+=e.length;var s=t.indexOf(n,o);-1!==s&&(i=t.substr(o,s-o))}return i}function L(t,e,i){void 0===i&&(i=".");var o=[];if(null===t||!_(t,i))return o;for(var s=0,r=t.length,a=new RegExp("[^"+n(i)+"]+$");r>s;){var c=t.substr(s,e);_(c,i)||(o.push(h(c,c.length)),s+=c.length),c=c.replace(a,""),o.push(c),s+=c.length}return o}function O(t,e){var n;if(null===t&&(t=""),null===e&&(e=""),t===e)return 0;var i,o,s=[],r=t.length,a=e.length;if(0===r)return a;if(0===a)return r;for(n=0;r>=n;n++)s[n]=[];for(n=0;r>=n;n++)s[n][0]=n;for(o=0;a>=o;o++)s[0][o]=o;for(n=1;r>=n;n++){var c=t.charAt(n-1);for(o=1;a>=o;o++){var u=e.charAt(o-1);i=c===u?0:1,s[n][o]=Math.min(s[n-1][o]+1,s[n][o-1]+1,s[n-1][o-1]+i)}}return s[r][a]}function M(t,e){var n=O(t,e),i=Math.max(t.length,e.length);return 0===i?1:1-n/i}var R={escapePattern:n,trim:i,trimLeft:o,trimRight:s,padLeft:r,padRight:a,removeExtraWhitespace:c,remove:u,truncate:h,capitalize:d,properCase:l,reverse:p,reverseWords:f,stripTags:g,swapCase:v,contains:_,countOf:m,endsWith:y,hasText:x,isEmpty:b,isNumeric:w,wordCount:E,afterFirst:A,afterLast:S,beginsWith:C,beforeFirst:j,beforeLast:T,between:P,block:L,editDistance:O,similarity:M};"object"==typeof e&&e.exports&&(e.exports=R)},{}],28:[function(t,e){"use strict";var n={};!function(){for(var t=/\+/g,e=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(t," "))},o=window.location.search.substring(1),s=e.exec(o);s;)n[i(s[1])]=i(s[2]),s=e.exec(o)}(),"object"==typeof e&&e.exports&&(e.exports=n)},{}],29:[function(t,e){"use strict";function n(t,e){this.x=t||0,this.y=e||0}n.prototype={add:function(t,e){return e?(this.x=this.x+t.x,this.y=this.y+t.y,this):n.get(this.x+t.x,this.y+t.y)},subtract:function(t,e){return e?(this.x=this.x-t.x,this.y=this.y-t.y,this):n.get(this.x-t.x,this.y-t.y)},multiply:function(t,e){return e?(this.x=this.x*t.x,this.y=this.y*t.y,this):n.get(this.x*t.x,this.y*t.y)},divide:function(t,e){return e?(this.x=this.x/t.x,this.y=this.y/t.y,this):n.get(this.x/t.x,this.y/t.y)},normalize:function(){var t=this.length;return 0===t?(this.x=1,this):(this.x/=t,this.y/=t,this)},isNormalized:function(){return 1===this.length},truncate:function(t){return this.length>t&&(this.length=t),this},scaleBy:function(t){return this.x*=t,this.y*=t,this},divideBy:function(t){return this.x/=t,this.y/=t,this},equals:function(t){return this.x===t.x&&this.y===t.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},reverse:function(){return this.negate(),this},dotProduct:function(t){return this.x*t.x+this.y*t.y},crossProduct:function(t){return this.x*t.y-this.y*t.x},distanceSquared:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},distance:function(t){return Math.sqrt(this.distanceSquared(t))},clone:function(){return n.get(this.x,this.y)},zero:function(){return this.x=0,this.y=0,this},isZero:function(){return 0===this.x&&0===this.y},reset:function(){return this.zero()},perpendicular:function(){return n.get(-this.y,this.x)},sign:function(t){var e=this.perpendicular(),n=e.dotProduct(t)<0?-1:1;return e.dispose(),n},set:function(t,e){return this.x=t||0,this.y=e||0,this},dispose:function(){n.pool.push(this.zero())}},n.pool=[],n.get=function(t,e){var i=n.pool.length>0?n.pool.pop():new n;return i.set(t,e),i},n.angleBetween=function(t,e){return t.isNormalized()||(t=t.clone().normalize()),e.isNormalized()||(e=e.clone().normalize()),Math.acos(t.dotProduct(e))},Object.defineProperty(n.prototype,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y}}),Object.defineProperty(n.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},set:function(t){var e=this.angle;this.x=Math.cos(e)*t,this.y=Math.sin(e)*t}}),Object.defineProperty(n.prototype,"angle",{get:function(){return Math.atan2(this.y,this.x)},set:function(t){var e=this.length;this.x=Math.cos(t)*e,this.y=Math.sin(t)*e}}),"object"==typeof e&&e.exports&&(e.exports=n)},{}],30:[function(t,e){"use strict";function n(){var t,e=["NETWORK_EMPTY","NETWORK_IDLE","NETWORK_LOADING","NETWORK_NO_SOURCE"],n=["HAVE_NOTHING","HAVE_METADATA","HAVE_CURRENT_DATA","HAVE_FUTURE_DATA","HAVE_ENOUGH_DATA"],o=["","ABORTED","NETWORK","DECODE","SRC_NOT_SUPPORTED"],s=null,r=new i.Signal,a=new i.Signal,c=new i.Signal,u=new i.Signal,h=new i.Signal,d=null,l=function(){r.dispatch(t)},p=function(){a.dispatch(t)},f=function(){u.dispatch(t)},g=function(e){c.dispatch(t,e.target.error)},v=function(){h.getNumListeners()>0&&h.dispatch(t,s.currentTime)},_=function(){null===s&&(s=document.createElement("video"),s.addEventListener("canplaythrough",l,!1),s.addEventListener("play",p,!1),s.addEventListener("playing",p,!1),s.addEventListener("error",g,!1),s.addEventListener("ended",f,!1),s.addEventListener("timeupdate",v,!1))},m=function(){if(clearTimeout(d),r.removeAll(),a.removeAll(),c.removeAll(),u.removeAll(),h.removeAll(),null!==s){s.pause();try{s.removeAttribute("src")}catch(t){}}},y=function(){m(),null!==s&&(s.removeEventListener("canplaythrough",l,!1),s.removeEventListener("play",p,!1),s.removeEventListener("playing",p,!1),s.removeEventListener("error",g,!1),s.removeEventListener("ended",f,!1),s.removeEventListener("timeupdate",v,!1),s.parentElement&&s.parentElement.removeChild(s),s=null)},x=function(t){null===s&&_(),s.setAttribute("preload","auto"),s.setAttribute("src",t),s.load()},b=function(t){void 0===t&&(t=40),w(),d=setTimeout(function(){E(),A(0)},t)},w=function(){s&&(clearTimeout(d),s.play())},E=function(){s&&s.pause()},A=function(t){try{s.currentTime=t}catch(e){}},S=function(){if(s){var t=s.networkState;return e[t]}return""},C=function(){if(s){var t=s.readyState;return n[t]}return""},j=function(){if(s){var t=s.error?s.error.code:0;return o[t]}return""},T=function(){if(isNaN(s.duration))return-1;var t=-1;return s.buffered&&s.buffered.length>0&&s.buffered.end&&s.duration&&(t=s.buffered.end(0)/s.duration,isNaN(t)&&(t=-1)),Math.round(10*t)/10};return t={onReady:r,onPlay:a,onError:c,onEnded:u,onTimeUpdate:h,create:_,load:x,forceLoad:b,unload:m,destroy:y,play:w,pause:E,seek:A,getBufferProgress:T,getReadyStateString:C,getNetworkStateString:S,getErrorStateString:j,getElement:function(){return s},getVolume:function(){return null===s?0/0:s.volume},setVolume:function(t){null!==s&&(s.volume=t)}}}var i=t("signals");"object"==typeof e&&e.exports&&(e.exports=n)},{signals:1}],31:[function(t,e){"use strict";var n=t("signals"),i=t("./resize.js"),o=t("./legacy/event-utils.js"),s={rect:{x:0,y:0,width:0,height:0,stageWidth:0,stageHeight:0,scale:1},originalWidth:0,originalHeight:0,init:function(t,e){this.originalWidth=t,this.originalHeight=e;var n=this;window.onresize=window.onorientationchange=function(){n.resize()},this.resize()},resize:function(){this.rect.x=0,this.rect.y=0,this.rect.width=this.originalWidth,this.rect.height=this.originalHeight,this.rect.stageWidth=this.getWindowWidth(),this.rect.stageHeight=this.getWindowHeight(),this.rect.scale=1,this.rect.stageWidth>this.rect.stageHeight?i(this.rect,this.rect.stageWidth,this.rect.stageHeight,!0,"fill"):i(this.rect,this.rect.stageWidth,this.rect.stageHeight,!0,"fitWidth"),this.rect.scale=this.rect.width/this.originalWidth,this.onResize.dispatch()},mouseLeftWindow:function(t,e){o.addEvent("mouseout",document,function(n){n=n?n:window.event;var i=n.relatedTarget||n.toElement;i&&"HTML"!==i.nodeName||t.call(e||this)})},getWindowWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0},getWindowHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0},getScrollTop:function(){return document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset||0},getWindowScrollY:function(){return window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0},getDocHeight:function(){return Math.max(document.body.scrollHeight||0,document.documentElement.scrollHeight||0,document.body.offsetHeight||0,document.documentElement.offsetHeight||0,document.body.clientHeight||0,document.documentElement.clientHeight||0)},getScrollPercentage:function(){return(this.getWindowScrollY()+this.getWindowHeight())/this.getDocHeight()*100},onResize:new n.Signal};"object"==typeof e&&e.exports&&(e.exports=s)},{"./legacy/event-utils.js":16,"./resize.js":23,signals:1}],32:[function(t,e){"use strict";function n(){document[i]?r.dispatch():a.dispatch()}var i,o,s=t("signals"),r=new s.Signal,a=new s.Signal;"undefined"!=typeof document.hidden?(i="hidden",o="visibilitychange"):"undefined"!=typeof document.mozHidden?(i="mozHidden",o="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(i="msHidden",o="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(i="webkitHidden",o="webkitvisibilitychange"),void 0!==o&&document.addEventListener(o,n,!1);var c={onPageShown:a,onPageHidden:r};"object"==typeof e&&e.exports&&(e.exports=c)},{signals:1}],33:[function(t,e){"use strict";function n(t){this.context=t||n.createContext(),this.context&&(this._sound=[],this._node=[],this._gain=this.context.createGain(),this._gain.connect(this.context.destination),this._startedAt=0,this._pausedAt=0,this._loop=!1,this._playing=!1,this._nodeFactory=new n.NodeFactory(this.context))}n.prototype={add:function(t){return this._sound.push(new n.Sound(t,this.context)),this._sound[this._sound.length-1].loop=this._loop,this._sound[this._sound.length-1]},play:function(){for(var t,e=-1,n=0;n<this._sound.length;n++)this._sound[n].stop(),this._sound[n].connect(this._gain),this._sound[n].play(0,this._pausedAt/1e3),this._sound[n].duration>e&&(e=this._sound[n].duration,t=this._sound[n]);var i=this;t.source.onended=function(){i._playing=!1},this._startedAt=Date.now()-this._pausedAt,this._playing=!0},pause:function(){this.stop(),this._pausedAt=Date.now()-this._startedAt},stop:function(){for(var t=0;t<this._sound.length;t++)this._sound[t].stop();this._pausedAt=0,this._playing=!1}},Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t;for(var e=0;e<this._sound.length;e++)this._sound[e].loop=t}}),Object.defineProperty(n.prototype,"volume",{get:function(){return this._gain.gain.value},set:function(t){isNaN(t)||(this._gain.gain.value=t)}}),Object.defineProperty(n.prototype,"playing",{get:function(){return this._playing}}),Object.defineProperty(n.prototype,"paused",{get:function(){return this._pausedAt>0}}),Object.defineProperty(n.prototype,"sound",{get:function(){return this._sound}}),Object.defineProperty(n.prototype,"nodeFactory",{get:function(){return this._nodeFactory}}),n.createContext=function(){var t=null;return window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(t=new window.AudioContext),t},n.Sound=function(t,e){this._buffer=t,this._context=e,this._source=null,this._node=[],this._loop=!1,this.name=""},n.Sound.prototype={play:function(t,e){void 0===t?t=0:t>0&&(t=this._context.currentTime+t),void 0===e&&(e=0),this.source.loop=this._loop,this.source.start(t,e)},stop:function(){this._source&&(this._source.stop(0),this._source=null)},connect:function(t){this._node.length>0?this._node[this._node.length-1].connect(t):this.source.connect(t),this.destination=t},addNode:function(t){this._node.push(t),this.updateConnections()},updateConnections:function(){if(this._source){for(var t=0;t<this._node.length;t++)0===t?this._source.connect(this._node[t]):this._node[t-1].connect(this._node[t]);this.destination&&this.connect(this.destination)}}},Object.defineProperty(n.Sound.prototype,"source",{get:function(){return this._source||(this._source=this._context.createBufferSource(),this._source.buffer=this._buffer,this.updateConnections()),this._source}}),Object.defineProperty(n.Sound.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t}}),Object.defineProperty(n.Sound.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),n.NodeFactory=function(t){function e(e,n){var i=t.createBiquadFilter();return i.type=e,void 0!==n&&(i.frequency.value=n),i}function n(t,e){return void 0===t&&(t=e),t}return{gain:function(e){var n=t.createGain();return void 0!==e&&(n.gain.value=e),n},pan:function(e,i,o){var s=t.createPanner();return n(e,0),n(i,0),n(o,.5),s.setPosition(e,i,o),s},filter:{lowpass:function(t){return e("lowpass",t)},highpass:function(t){return e("highpass",t)},bandpass:function(t){return e("bandpass",t)},lowshelf:function(t){return e("lowshelf",t)},highshelf:function(t){return e("highshelf",t)},peaking:function(t){return e("peaking",t)},notch:function(t){return e("notch",t)},allpass:function(t){return e("allpass",t)}},delay:function(e){var n=t.createDelay();return void 0!==e&&(n.delayTime=e),n},convolver:function(){var e=t.createConvolver();return e},analyser:function(){var e=t.createAnalyser();return e.smoothingTimeConstant=.85,e}}},n.Effects=function(t){function e(e,n,i){e.linearRampToValueAtTime(n,t.currentTime+i)}return{fade:function(t,n,i){e(t.gain,n,i)}}},"object"==typeof e&&e.exports&&(e.exports=n)},{}],34:[function(t,e){"use strict";t("./lib/legacy/console-patch.js"),t("./lib/raf-polyfill.js");var n={};n.array=t("./lib/array-utils.js"),n.css=t("./lib/legacy/css-utils.js"),n.device=t("./lib/device.js"),n.event=t("./lib/legacy/event-utils.js"),n.fullscreen=t("./lib/fullscreen.js"),n.keyboard=t("./lib/keyboard.js"),n.math=t("./lib/math-utils.js"),n.share=t("./lib/share.js"),n.storage=t("./lib/storage-utils.js"),n.string=t("./lib/string-utils.js"),n.urlParams=t("./lib/url-params.js"),n.visibility=t("./lib/visibility.js"),n.AssetLoader=t("./lib/asset-loader.js"),n.AudioManager=t("./lib/audio-manager.js"),n.Boid=t("./lib/boid.js"),n.FPS=t("./lib/fps.js"),n.Graphics=t("./lib/graphics.js"),n.HTMLAudio=t("./lib/html-audio.js"),n.InputCoords=t("./lib/input-coords.js"),n.KeyInput=t("./lib/key-input.js"),n.LinkedList=t("./lib/linked-list.js"),n.ObjectPool=t("./lib/object-pool.js"),n.StateMachine=t("./lib/state-machine.js"),n.Vec2=t("./lib/vec2.js"),n.VideoObject=t("./lib/video-object.js"),n.Viewport=t("./lib/viewport.js"),n.WebAudio=t("./lib/web-audio.js"),n.popup=t("./lib/popup.js"),n.ready=t("./lib/ready.js"),n.resize=t("./lib/resize.js"),e.exports=n},{"./lib/array-utils.js":2,"./lib/asset-loader.js":3,"./lib/audio-manager.js":4,"./lib/boid.js":5,"./lib/device.js":6,"./lib/fps.js":7,"./lib/fullscreen.js":8,"./lib/graphics.js":9,"./lib/html-audio.js":10,"./lib/input-coords.js":11,"./lib/key-input.js":12,"./lib/keyboard.js":13,"./lib/legacy/console-patch.js":14,"./lib/legacy/css-utils.js":15,"./lib/legacy/event-utils.js":16,"./lib/linked-list.js":17,"./lib/math-utils.js":18,"./lib/object-pool.js":19,"./lib/popup.js":20,"./lib/raf-polyfill.js":21,"./lib/ready.js":22,"./lib/resize.js":23,"./lib/share.js":24,"./lib/state-machine.js":25,"./lib/storage-utils.js":26,"./lib/string-utils.js":27,"./lib/url-params.js":28,"./lib/vec2.js":29,"./lib/video-object.js":30,"./lib/viewport.js":31,"./lib/visibility.js":32,"./lib/web-audio.js":33}]},{},[34])(34)});